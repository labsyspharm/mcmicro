// Module definitions
includeConfig 'config/modules.config'

// Platform-specific profiles
profiles {

  // Default profile, best suited for local runs
  standard {
    includeConfig 'config/docker.config'
  }

  // Profile for using singularity to run module containers
  singularity {
    includeConfig 'config/singularity.config'
  }

  // Profile specific to the HMS compute cluster
  O2 {
    includeConfig 'config/O2base.config'
    includeConfig 'config/large.config'
  }

  // Processing large WSI on the HMS compute cluster
  O2WSI {
    includeConfig 'config/O2base.config'
    includeConfig 'config/massive.config'
  }

  // Processing TMAs on the HMS compute cluster
  O2TMA {
    includeConfig 'config/O2base.config'
    includeConfig 'config/tma.config'
  }

  // Same as O2, but for external users not in the `lsp` group
  O2ext {
    includeConfig 'config/O2base.config'
    includeConfig 'config/large.config'
    singularity.cacheDir = "$HOME/.mcmicro"
  }

  // Same as O2WSI but with GPU support for worker processes
  O2gpu {
    includeConfig 'config/O2base.config'
    includeConfig 'config/massive.config'

    singularity.runOptions = '-C --nv'
    process{
      withName:worker {
        queue = 'gpu'
        clusterOptions = '--gres=gpu:1'
      }
    }
  }
  
  // Same as O2 (here for backwards compatibility)
  O2large {
    includeConfig 'config/O2base.config'
    includeConfig 'config/large.config'
  }
  
  // Same as O2WSI (here for backwards compatibility)
  O2massive {
    includeConfig 'config/O2base.config'
    includeConfig 'config/massive.config'
  }

  // Amazon Web Services
  AWS {
    includeConfig 'config/aws.config'
    includeConfig 'config/large.config'
  }

  AWSWSI {
    includeConfig 'config/aws.config'
    includeConfig 'config/massive.config'
  }  

  AWSTMA {
    includeConfig 'config/aws.config'
    includeConfig 'config/tma.config'
  }    

  AWSgpu {
    includeConfig 'config/aws.config'
    includeConfig 'config/massive.config'
    
    process {
      withName:pmproc {
        queue = 'mcmicro-queue-gpu'
      }
    }
  }
  
}
